function Fincode(apiKey){var config;if(_checkRequire(apiKey))return{config:config={api:{host:"https://api.fincode.jp/",context:"v1"},headers:{accept:"application/json",contentType:"application/json",tenantShopId:"",idempotentKey:""},apiKey:apiKey},setTenantShopId:function(tenantShopId){if(!_checkRequire(tenantShopId))throw new Error("tenantShopId が指定されていません");!function(tenantShopId){config.headers.tenantShopId=tenantShopId}(tenantShopId)},setIdempotentKey:function(idempotentKey){if(!_checkRequire(idempotentKey))throw new Error("idempotentKey が指定されていません");!function(idempotentKey){config.headers.idempotentKey=idempotentKey}(idempotentKey)},payments:function(transaction,callBack,errorCallBack){if(!_checkRequire(transaction))throw new Error("transaction が指定されていません");let id=null;var data={};if(_isObject(transaction))for(let i=0,keys=Object.keys(transaction);i<keys.length;i++){var key=keys[i];"id"==key?id=transaction[key]:data[key]=transaction[key]}if(!_checkRequire(id))throw new Error("transaction.id が指定されていません");!function(order_id,transaction,callBack,errorCallBack){_sendRequest(config.api.host+config.api.context+"/payments/"+order_id,"PUT",transaction,callBack,errorCallBack)}(id,data,callBack,errorCallBack)},cards:function(card,callBack,errorCallBack){if(!_checkRequire(card))throw new Error("card が指定されていません");let customer_id=null,card_id=null;var data={};if(_isObject(card))for(let i=0,keys=Object.keys(card);i<keys.length;i++){var key=keys[i];"customer_id"==key?customer_id=card[key]:"card_id"==key?card_id=card[key]:data[key]=card[key]}if(!_checkRequire(customer_id))throw new Error("card.customer_id が指定されていません");_checkRequire(card_id)?function(customer_id,card_id,card,callBack,errorCallBack){_sendRequest(config.api.host+config.api.context+"/customers/"+customer_id+"/cards/"+card_id,"PUT",card,callBack,errorCallBack)}(customer_id,card_id,data,callBack,errorCallBack):function(customer_id,card,callBack,errorCallBack){_sendRequest(config.api.host+config.api.context+"/customers/"+customer_id+"/cards","POST",card,callBack,errorCallBack)}(customer_id,data,callBack,errorCallBack)},tokens:function(card,callBack,errorCallBack){if(!_checkRequire(card))throw new Error("card が指定されていません");var data={};if(_isObject(card))for(let i=0,keys=Object.keys(card);i<keys.length;i++){var key=keys[i];data[key]=card[key]}!function(card,callBack,errorCallBack){_sendRequest(config.api.host+config.api.context+"/tokens/cards","POST",card,callBack,errorCallBack)}(data,callBack,errorCallBack)},getCardsList:function(customer_id,callBack,errorCallBack){if(!_checkRequire(customer_id))throw new Error("customer_id が指定されていません");!function(customer_id,callBack,errorCallBack){_sendRequest(config.api.host+config.api.context+"/customers/"+customer_id+"/cards","GET","",callBack,errorCallBack)}(customer_id,callBack,errorCallBack)},ui:function(appearance){if(!_checkRequire(appearance))throw new Error("appearance が指定されていません");if(_isObject(appearance))for(let i=0,keys=Object.keys(appearance);i<keys.length;i++){var key=keys[i];key,appearance[key]}return _ui(appearance)}};throw new Error("Public key が指定されていません");function _checkRequire(arg){return null!=arg&&""!==arg}function _isObject(obj){return"object"==(void 0===obj?"undefined":typeof obj)&&null!==obj}function _sendRequest(url,method,data,callBack,errorCallBack){var xhr=new XMLHttpRequest;xhr.open(method,url),xhr.setRequestHeader("Accept",config.headers.accept),xhr.setRequestHeader("Content-Type",config.headers.contentType),xhr.setRequestHeader("Authorization","Bearer "+config.apiKey),_checkRequire(config.headers.tenantShopId)&&xhr.setRequestHeader("Tenant-Shop-Id",config.headers.tenantShopId),_checkRequire(config.headers.idempotentKey)&&xhr.setRequestHeader("idempotent_key",config.headers.idempotentKey),xhr.addEventListener("load",()=>{null!=callBack&&"function"==typeof callBack&&callBack(xhr.status,JSON.parse(xhr.response))}),xhr.addEventListener("error",()=>{null!=errorCallBack&&"function"==typeof errorCallBack&&errorCallBack("request errro.")}),xhr.send(JSON.stringify(data))}function _ui(appearance){var ui;if(_checkRequire(appearance))return ui={api:{host:"https://js.fincode.jp/_templates/CardPaymentInputElements",host2:"https://js.fincode.jp",context:"v1",urls:""},apiKey:config.apiKey,appearance:appearance,elementId:"",tenantShopId:config.headers.tenantShopId,form:{cardNo:"",CVC:"",year:"",month:""}},window.addEventListener("message",function(event){var buttonHeight,elements;return event.origin!==ui.api.host2?0:"getCardData"==event.data.action?(ui.form=event.data.form,event.data.form):void("iframeSize"==event.data.action&&(event.data.size,document.getElementById(ui.elementId+"-ui").style.height=parseInt(event.data.size.height,10)+80+"px",buttonHeight=0,elements=document.getElementById(ui.elementId+"-form").querySelectorAll("button"),Array.from(elements).filter(item=>"none"!==window.getComputedStyle(item).display).forEach(item=>{buttonHeight+=item.scrollHeight+ +window.getComputedStyle(item).marginTop.replace("px","")+ +window.getComputedStyle(item).marginBottom.replace("px","")}),document.getElementById(ui.elementId+"-form").style.height=document.getElementById(ui.elementId+"-ui").scrollHeight+40+buttonHeight+"px",document.getElementById(ui.elementId).style.width=event.data.size.width))}),{appearance:ui,create:function(method,appearance,callBack,errorCallBack){if(!_checkRequire(appearance))throw new Error("appearance が指定されていません");if(!_checkRequire(method))throw new Error("method が指定されていません");var data={};if(_isObject(appearance))for(let i=0,keys=Object.keys(appearance);i<keys.length;i++){var key=keys[i];data[key]=appearance[key]}_create(method,data)},mount:function(elementId,width="500",callBack,errorCallBack){if(!_checkRequire(elementId))throw new Error("elementId が指定されていません");"loading"===document.readyState&&console.warn("DOM が読み込まれていません"),function(elementId,width="500"){parseInt(width,10)<=250?width="250":768<=parseInt(width,10)&&(width="768"),ui.elementId=elementId;const base=document.getElementById(elementId);var base2=document.getElementById(elementId+"-form"),formWidth=parseInt(width,10)+30,fragment=(base2.setAttribute("style","width:"+formWidth+"px; height:250px; padding:15px; margin:15px; border-radius:0.5em; box-shadow: 0px 0px 0px 0.5px rgb(50 50 93 / 10%), 0px 2px 5px 0px rgb(50 50 93 / 10%), 0px 1px 1.5px 0px rgb(0 0 0 / 7%)"),"fincode"===ui.appearance.theme?base2.style.backgroundColor="#000054":"dark"===ui.appearance.theme?base2.style.backgroundColor="#1f1f1f":base2.style.backgroundColor="#"+ui.appearance.colorBackground,(obj=document.createElement("iframe")).id=elementId+"-ui",obj.setAttribute("frameBorder","0"),obj.setAttribute("scrolling","no"),obj.style.width=width+"px",obj.style.height="500px",obj.src=ui.api.urls,document.createDocumentFragment());fragment.appendChild(obj),"complete"===document.readyState?null===document.getElementById(obj.id)&&base.appendChild(fragment):null===document.getElementById(obj.id)&&window.addEventListener("load",function(){null===document.getElementById(obj.id)&&base.appendChild(fragment)})}(elementId,width)},getFormData:async function(){return data=await _get()},destroy:function(callBack,errorCallBack){if(!_checkRequire(ui.elementId))throw new Error("elementId が存在しません");var elementId;elementId=ui.elementId,document.getElementById(elementId).innerHTML=""}};throw new Error("Appearance が指定されていません");function _create(method,appearance){!function(method,appearance){var data=appearance,appearance=(appearance.apiKey=config.apiKey,appearance.tenantShopId=config.headers.tenantShopId,new URLSearchParams(data).toString()),data=encodeURI(appearance),appearance=ui.api.host+"?method="+method+"&"+data;ui.api.urls=appearance}(method,appearance)}async function _get(){var num;return document.getElementById(ui.elementId+"-ui").contentWindow.postMessage({action:"getCardData"},ui.api.host2),num=30,await new Promise(s=>setTimeout(s,num)),ui.form}}}